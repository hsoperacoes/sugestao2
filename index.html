<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>HS Central ‚Äî Avalia√ß√µes & Reclama√ß√µes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b1220;--muted:#8aa0bf;--txt:#e9eefc;--card:#121a2b;--brand:#43b0ff;--ok:#21c55d;--warn:#f59e0b;--err:#ef4444;--ring:0 0 0 3px rgba(67,176,255,.2);--radius:18px;--shadow:0 12px 36px rgba(17,25,40,.28) }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1220 0%,#0d1526 60%,#0b1220 100%);color:var(--txt);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand .logo{width:44px;height:44px;border-radius:12px;display:grid;place-items:center;background:radial-gradient(90px 90px at 30% 30%,#5bd5ff 0%,#43b0ff 40%,#2d79ff 100%);box-shadow:var(--shadow)}
    .brand h1{margin:0;font-size:clamp(20px,2.4vw,28px);font-weight:700;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px}
    .card{background:linear-gradient(180deg,#121a2b 0%,#0f182b 100%);border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow)}
    .hero{margin:24px 0;padding:22px 22px;border-radius:var(--radius);display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    .hero h2{margin:0 0 8px;font-size:clamp(18px,2.2vw,24px)}
    .badges{display:flex;gap:8px;flex-wrap:wrap}
    .badge{padding:6px 10px;border-radius:999px;background:#0d1931;border:1px solid rgba(255,255,255,.08);font-size:12px;color:var(--muted)}
    .panel{margin:20px 0;padding:18px}
    .grid{display:grid;gap:14px}
    @media(min-width:860px){.grid.cols-2{grid-template-columns:1fr 1fr}.grid.cols-3{grid-template-columns:repeat(3,1fr)}}
    label{font-weight:600;font-size:13px;margin-bottom:6px;display:block}
    .row{display:grid;gap:6px}
    input[type="text"],input[type="email"],select,textarea{ width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0e1629;color:var(--txt);outline:none }
    textarea{min-height:120px;resize:vertical}
    input:focus,select:focus,textarea:focus{box-shadow:var(--ring);border-color:#2f80ff}
    .help{font-size:12px;color:var(--muted)}
    .inline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .switch{position:relative;width:50px;height:28px;background:#1a253a;border-radius:999px;border:1px solid rgba(255,255,255,.1);cursor:pointer}
    .knob{position:absolute;top:2px;left:2px;width:24px;height:24px;border-radius:50%;background:#fff;transition:all .2s}
    .switch.on{background:#1f3a5f}
    .switch.on .knob{left:24px;background:#dff3ff}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.08);background:#0d1931;font-size:13px;cursor:pointer;user-select:none}
    .chip input{appearance:none;width:16px;height:16px;border-radius:4px;border:1px solid rgba(255,255,255,.25);display:grid;place-items:center}
    .chip input:checked{background:conic-gradient(from 210deg at 50% 50%,#2f80ff 0%,#43b0ff 100%);border-color:transparent}
    .rating{display:flex;gap:6px}
    .star{width:28px;height:28px;cursor:pointer;filter:drop-shadow(0 2px 6px rgba(0,0,0,.25))}
    .muted{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{appearance:none;padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,#1c2b49 0%,#18243d 100%);color:var(--txt);font-weight:700;cursor:pointer}
    .btn-primary{background:linear-gradient(180deg,#46b7ff 0%,#2f80ff 100%);border:none;color:#0b1220}
    .btn-ghost{background:#0f192e}
    .notice{padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0f192e;display:flex;gap:10px;align-items:flex-start}
    .notice.ok{border-color:rgba(33,197,93,.35)}
    .notice.err{border-color:rgba(239,68,68,.35)}
    .hidden{display:none!important}
    footer{margin:28px 0 40px;color:var(--muted);font-size:12px;text-align:center}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);margin:10px 0 6px}
    .proto{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0d1931;border-radius:10px;padding:6px 8px;display:inline-block}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">üëï</div>
        <div>
          <h1>HS Central ‚Äî Avalia√ß√µes & Reclama√ß√µes</h1>
          <div class="sub">Sua opini√£o ajuda a melhorar a experi√™ncia em todas as lojas.</div>
        </div>
      </div>
      <div class="inline muted">
        <span id="protocolBox" class="proto" title="Protocolo desta sess√£o"></span>
      </div>
    </header>

    <section class="hero card">
      <div>
        <h2>Envie uma avalia√ß√£o sobre a loja ou um elogio/reclama√ß√£o de um funcion√°rio</h2>
        <p class="muted">Voc√™ pode se identificar ou enviar de forma an√¥nima. O feedback ser√° encaminhado por e‚Äëmail automaticamente para a equipe respons√°vel.</p>
        <div class="badges" aria-label="op√ß√µes r√°pidas">
          <span class="badge">Anonimato opcional</span>
          <span class="badge">R√°pido de preencher</span>
          <span class="badge">Encaminhamento por e‚Äëmail</span>
        </div>
      </div>
      <div class="notice">
        <div>‚ÑπÔ∏è</div>
        <div>
          <strong>Privacidade:</strong> se optar por <em>an√¥nimo</em>, n√£o coletaremos nome, e‚Äëmail ou telefone. Usamos apenas o que for necess√°rio para entender seu relato.
        </div>
      </div>
    </section>

    <form id="formFeedback" class="card panel" novalidate>
      <div class="grid cols-3">
        <div class="row">
          <label for="filial">Filial</label>
          <select id="filial" name="filial" required>
            <option value="" selected disabled>Selecione‚Ä¶</option>
            <option value="293">293 ‚Äî ARTUR</option>
            <option value="488">488 ‚Äî FLORIANO</option>
            <option value="287">287 ‚Äî JOTA</option>
            <option value="288">288 ‚Äî MODA</option>
            <option value="761">761 ‚Äî PONTO</option>
          </select>
          <div class="help">Escolha a loja relacionada ao seu feedback.</div>
        </div>
        <div class="row">
          <label for="tipoEscopo">Tipo</label>
          <select id="tipoEscopo" name="tipoEscopo" required>
            <option value="" selected disabled>Selecione‚Ä¶</option>
            <option value="loja">Avalia√ß√£o da Loja</option>
            <option value="funcionario">Elogio/Reclama√ß√£o de Funcion√°rio</option>
          </select>
        </div>
        <div class="row">
          <label>Enviar como an√¥nimo?</label>
          <div class="inline">
            <div id="anonSwitch" class="switch" role="switch" aria-checked="false" tabindex="0"><div class="knob"></div></div>
            <input type="hidden" id="anonimo" name="anonimo" value="nao" />
            <span class="help">Ative para ocultar seus dados pessoais.</span>
          </div>
        </div>
      </div>

      <div id="blocoPessoal" class="panel card">
        <div class="grid cols-3">
          <div class="row"><label for="nome">Seu nome (obrigat√≥rio se n√£o for an√¥nimo)</label><input id="nome" name="nome" type="text" placeholder="Ex.: Maria Silva" /></div>
          <div class="row"><label for="email">E‚Äëmail (opcional)</label><input id="email" name="email" type="email" placeholder="seunome@email.com" /></div>
          <div class="row"><label for="telefone">Telefone (opcional)</label><input id="telefone" name="telefone" type="text" placeholder="(xx) xxxxx‚Äëxxxx" /></div>
        </div>
        <div class="help">Seus dados ajudam caso seja necess√°rio retornar o contato ‚Äî deix√°‚Äëlos em branco mant√©m seu relato an√¥nimo.</div>
      </div>

      <div id="blocoLoja" class="panel card hidden">
        <div class="grid cols-2">
          <div class="row">
            <label>Categoria(s) da avalia√ß√£o</label>
            <div class="chips">
              <label class="chip"><input type="checkbox" name="cats" value="Limpeza">Limpeza</label>
              <label class="chip"><input type="checkbox" name="cats" value="Organiza√ß√£o">Organiza√ß√£o</label>
              <label class="chip"><input type="checkbox" name="cats" value="Atendimento">Atendimento</label>
              <label class="chip"><input type="checkbox" name="cats" value="Falta de mercadoria">Falta de mercadoria</label>
              <label class="chip"><input type="checkbox" name="cats" value="Pre√ßo">Pre√ßo</label>
              <label class="chip"><input type="checkbox" name="cats" value="Troca/Devolu√ß√£o">Troca/Devolu√ß√£o</label>
              <label class="chip"><input type="checkbox" name="cats" value="Acessibilidade">Acessibilidade</label>
              <label class="chip"><input type="checkbox" name="cats" value="Tempo de espera">Tempo de espera</label>
              <label class="chip"><input type="checkbox" name="cats" value="Ambiente/M√∫sica">Ambiente/M√∫sica</label>
            </div>
          </div>
          <div class="row">
            <label for="tipoMercadoria">Tipo de mercadoria (opcional)</label>
            <input id="tipoMercadoria" name="tipoMercadoria" type="text" placeholder="Ex.: camisetas b√°sicas, jeans, infantil‚Ä¶" />
            <div class="help">Campo livre ‚Äî preencha se o seu relato for sobre um tipo espec√≠fico.</div>
          </div>
        </div>
        <div class="row">
          <label for="mensagemLoja">Conte-nos mais</label>
          <textarea id="mensagemLoja" name="mensagemLoja" placeholder="Descreva com detalhes o que aconteceu, quando e com quem (se aplic√°vel)."></textarea>
        </div>
        <div class="row">
          <label for="anexosLoja">Anexar imagem (opcional)</label>
          <input id="anexosLoja" name="anexosLoja" type="file" accept="image/*" />
          <div class="help">Ajuda muito se tiver foto de etiqueta, g√¥ndola, fila, etc.</div>
        </div>
      </div>

      <div id="blocoFunc" class="panel card hidden">
        <div class="grid cols-3">
          <div class="row">
            <label for="tipoRelato">O que voc√™ deseja registrar?</label>
            <select id="tipoRelato" name="tipoRelato">
              <option value="elogio">Elogio</option>
              <option value="reclamacao">Reclama√ß√£o</option>
              <option value="avaliacao">Avalia√ß√£o / Nota</option>
            </select>
          </div>
          <div class="row">
            <label for="cargo">Cargo</label>
            <select id="cargo" name="cargo">
              <option value="vendedor">Vendedor(a)</option>
              <option value="gerente">Gerente</option>
            </select>
          </div>
          <div class="row">
            <label for="funcionario">Funcion√°rio</label>
            <select id="funcionario" name="funcionario">
              <option value="" disabled selected>Escolha a filial primeiro</option>
            </select>
            <div class="help">A lista √© carregada pela filial selecionada. H√° tamb√©m a op√ß√£o "Outro" ao final.</div>
          </div>
        </div>

        <div id="blocoAvaliacao" class="row">
          <label>Nota (1 a 5)</label>
          <div class="rating" role="radiogroup" aria-label="nota de 1 a 5">
            <img class="star" data-v="1" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23a3b3d6' d='M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z'/></svg>" alt="1 estrela" />
            <img class="star" data-v="2" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23a3b3d6' d='M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z'/></svg>" alt="2 estrelas" />
            <img class="star" data-v="3" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23a3b3d6' d='M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z'/></svg>" alt="3 estrelas" />
            <img class="star" data-v="4" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23a3b3d6' d='M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z'/></svg>" alt="4 estrelas" />
            <img class="star" data-v="5" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23a3b3d6' d='M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z'/></svg>" alt="5 estrelas" />
          </div>
          <input type="hidden" id="nota" name="nota" value="0" />
        </div>

        <div class="row">
          <label for="mensagemFunc">Detalhes do elogio/reclama√ß√£o/avalia√ß√£o</label>
          <textarea id="mensagemFunc" name="mensagemFunc" placeholder="Conte como foi sua experi√™ncia com esse funcion√°rio."></textarea>
        </div>
      </div>

      <div class="grid cols-2">
        <div class="row">
          <label class="inline">
            <input id="consent" type="checkbox" /> Concordo com o uso dos meus dados para contato e melhoria do atendimento.
          </label>
          <div class="help">Obrigat√≥rio apenas quando <strong>n√£o</strong> for an√¥nimo.</div>
        </div>
        <div class="row actions" style="justify-content:flex-end">
          <button type="button" class="btn-ghost" id="btnLimpar">Limpar</button>
          <button type="submit" class="btn-primary" id="btnEnviar">Enviar agora</button>
        </div>
      </div>

      <div id="boxMsg" class="notice hidden" role="status" aria-live="polite"></div>
    </form>

    <footer>
      ¬© <span id="year"></span> HS Central ‚Äî Canal de Feedback | <a href="#" class="muted" id="printLink">Imprimir/Salvar PDF</a>
    </footer>
  </div>

<script>
  const FUNCIONARIOS = {
    '293': { vendedor: ['Tainara', 'Polyana'], gerente: ['Lucinele'] },
    '488': { vendedor: ['Sara', 'Iolanda', 'Gabriela'], gerente: ['Meire'] },
    '287': { vendedor: ['Vera', 'Karina', 'Rayssa'], gerente: ['Bruno'] },
    '288': { vendedor: ['Maria', 'Marcia', 'Joana'], gerente: ['Dayane'] },
    '761': { vendedor: ['Dani', 'Isadora', 'Paula'], gerente: ['S√¥nia'] }
  };

  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const byId = id => document.getElementById(id);
  const protocol = () => 'HS-' + new Date().toISOString().replace(/[-:T.Z]/g,'').slice(0,14);
  const isAnon = () => byId('anonimo').value === 'sim';

  byId('protocolBox').textContent = protocol();
  byId('year').textContent = new Date().getFullYear();

  const sw = byId('anonSwitch');
  const setAnon = (on) => {
    if(on){ sw.classList.add('on'); sw.setAttribute('aria-checked','true'); byId('anonimo').value='sim'; byId('blocoPessoal').classList.add('hidden'); byId('consent').checked=false; }
    else { sw.classList.remove('on'); sw.setAttribute('aria-checked','false'); byId('anonimo').value='nao'; byId('blocoPessoal').classList.remove('hidden'); }
  };
  sw.addEventListener('click', ()=> setAnon(!sw.classList.contains('on')));
  sw.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); sw.click(); }});

  const toggleEscopo = () => {
    const t = byId('tipoEscopo').value;
    byId('blocoLoja').classList.toggle('hidden', t !== 'loja');
    byId('blocoFunc').classList.toggle('hidden', t !== 'funcionario');
  };
  byId('tipoEscopo').addEventListener('change', toggleEscopo);

  const carregarFuncionarios = () => {
    const filial = byId('filial').value; const cargo = byId('cargo').value; const sel = byId('funcionario');
    sel.innerHTML = '';
    if(!filial){ sel.innerHTML = '<option disabled selected>Escolha a filial primeiro</option>'; return; }
    const lista = (FUNCIONARIOS[filial] && FUNCIONARIOS[filial][cargo]) || [];
    if(lista.length === 0){ sel.innerHTML = '<option disabled selected>Sem cadastro</option>'; return; }
    sel.innerHTML = '<option disabled selected>Selecione‚Ä¶</option>' + lista.map(n => `<option value="${n}">${n}</option>`).join('') + '<option value="Outro">Outro (digitar no campo de detalhes)</option>';
  };
  byId('filial').addEventListener('change', ()=>{carregarFuncionarios();toggleEscopo();});
  byId('cargo').addEventListener('change', carregarFuncionarios);

  const paintStars = (n) => { $$('.star').forEach((el,i)=>{ const on = i < n; const fill = on ? '%23ffd34d' : '%23a3b3d6'; el.src = `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='${fill}' d='M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01z'/></svg>`; }); };
  $$('.star').forEach(el=> el.addEventListener('click', ()=>{ const v = +el.dataset.v; byId('nota').value = v; paintStars(v);}));

  byId('btnLimpar').addEventListener('click', ()=>{
    byId('formFeedback').reset(); setAnon(false); paintStars(0); byId('protocolBox').textContent = protocol();
    byId('boxMsg').className = 'notice hidden'; byId('boxMsg').textContent = '';
    byId('blocoLoja').classList.add('hidden'); byId('blocoFunc').classList.add('hidden');
    byId('funcionario').innerHTML = '<option disabled selected>Escolha a filial primeiro</option>';
  });

  byId('printLink').addEventListener('click', (e)=>{e.preventDefault(); window.print();});

  function validar(){
    const filial = byId('filial').value; const escopo = byId('tipoEscopo').value;
    if(!filial || !escopo) return 'Selecione a filial e o tipo (Loja/Funcion√°rio).';

    // Se N√ÉO for an√¥nimo, exigir consentimento e NOME
    if(!isAnon()){
      if(!byId('consent').checked) return 'Marque o consentimento para uso dos dados (ou ative o modo an√¥nimo).';
      const nome = byId('nome').value.trim();
      if(!nome) return 'Informe seu nome (obrigat√≥rio quando n√£o for an√¥nimo).';
    }

    if(escopo==='loja'){
      const msg = byId('mensagemLoja').value.trim(); if(!msg) return 'Descreva seu relato sobre a loja.';
    } else {
      const func = byId('funcionario').value; const msg = byId('mensagemFunc').value.trim(); const tipoRelato = byId('tipoRelato').value;
      if(!func) return 'Selecione o funcion√°rio (ou use "Outro" e descreva no texto).';
      if(!msg) return 'Descreva seu elogio/reclama√ß√£o/avalia√ß√£o.';
      if(tipoRelato==='avaliacao' && +byId('nota').value === 0) return 'Informe a nota (1 a 5) para a avalia√ß√£o.';
    }
    return null;
  }

  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbyipMWVLHxYE8hR3js46ZUmTm4zfGE2wZ8fqr_-fcHdR4v5xP_ujUZubghuu_imNcGkaQ/exec';

  async function toBase64(file){ return new Promise((resolve,reject)=>{ const r=new FileReader(); r.onload=()=>resolve(String(r.result)); r.onerror=reject; r.readAsDataURL(file); }); }

  byId('formFeedback').addEventListener('submit', async (e)=>{
    e.preventDefault(); const err = validar(); const box = byId('boxMsg'); if(err){ box.className='notice err'; box.textContent='‚ö†Ô∏è ' + err; return; }

    const escopo = byId('tipoEscopo').value;
    const payload = {
      protocolo: byId('protocolBox').textContent,
      dataISO: new Date().toISOString(),
      filial: byId('filial').value,
      anonimo: isAnon(),
      nome: byId('nome').value || null,
      email: byId('email').value || null,
      telefone: byId('telefone').value || null,
      escopo,
      consent: byId('consent').checked,
    };

    if(escopo==='loja'){
      payload.categorias = $$('input[name="cats"]:checked').map(i=>i.value);
      payload.tipoMercadoria = byId('tipoMercadoria').value || null;
      payload.mensagem = byId('mensagemLoja').value.trim();
      const f = byId('anexosLoja').files?.[0]; payload.anexo = f ? await toBase64(f) : null;
    } else {
      payload.tipoRelato = byId('tipoRelato').value; payload.cargo = byId('cargo').value; payload.funcionario = byId('funcionario').value; payload.nota = +byId('nota').value || null; payload.mensagem = byId('mensagemFunc').value.trim();
    }

    try {
      const box = byId('boxMsg'); box.className='notice'; box.textContent='‚è≥ Enviando seu feedback‚Ä¶';
      await fetch(ENDPOINT, { method:'POST', mode:'no-cors', body: JSON.stringify(payload) });
      box.className='notice ok'; box.innerHTML = `‚úÖ Obrigado! Seu protocolo √© <strong>${payload.protocolo}</strong>. Voc√™ receber√° retorno se necess√°rio.`;
      (document.scrollingElement||document.documentElement).scrollTo({top:0,behavior:'smooth'});
    } catch (e) {
      console.error(e); const box = byId('boxMsg'); box.className='notice err'; box.textContent='‚ùå N√£o foi poss√≠vel enviar agora: ' + (e.message || e);
    }
  });
</script>
</body>
</html>
